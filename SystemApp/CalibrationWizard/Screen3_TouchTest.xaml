<Window x:Class="KinectCalibrationWPF.CalibrationWizard.Screen3_TouchTest"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Calibration Wizard - Screen 3: Touch Detection Test" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen" ResizeMode="CanResize">
	<Window.Resources>
		<Style x:Key="WizardButtonStyle" TargetType="Button">
			<Setter Property="Padding" Value="15,8"/>
			<Setter Property="FontSize" Value="14"/>
			<Setter Property="FontWeight" Value="Bold"/>
			<Setter Property="Foreground" Value="White"/>
			<Setter Property="Background" Value="#2196F3"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="Button">
						<Border Background="{TemplateBinding Background}" CornerRadius="4">
							<ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	</Window.Resources>
	
                            <Grid>
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="Auto"/>
		</Grid.RowDefinitions>
		
		<!-- Header -->
		<Border Grid.Row="0" Background="#1976D2" Padding="20">
			<StackPanel>
				<TextBlock Text="Calibration Wizard - Screen 3" FontSize="24" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
				<TextBlock Text="Test the touch detection. A red square will appear on detected objects. Adjust sensitivity as needed." FontSize="14" Foreground="White" HorizontalAlignment="Center" Margin="0,5,0,0"/>
			</StackPanel>
		</Border>
		
		<!-- Main Content -->
		<Grid Grid.Row="1">
			<Grid.ColumnDefinitions>
				<ColumnDefinition Width="2*"/>
				<ColumnDefinition Width="*"/>
			</Grid.ColumnDefinitions>
			
			<!-- Depth View -->
			<Border Grid.Column="0" Background="White" CornerRadius="8" Margin="0,0,10,0">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="*"/>
						<RowDefinition Height="Auto"/>
					</Grid.RowDefinitions>
					<Border Grid.Row="0" Background="#000" Margin="10">
						<Viewbox x:Name="DepthViewContainer" Stretch="Uniform" HorizontalAlignment="Center" VerticalAlignment="Center">
							<Grid>
								<Grid.RenderTransform>
									<TransformGroup x:Name="DepthViewTransformGroup">
										<ScaleTransform x:Name="DepthScaleTransform"/>
										<ScaleTransform x:Name="DepthFlipTransform" ScaleY="-1"/>
										<TranslateTransform x:Name="DepthTranslateTransform"/>
									</TransformGroup>
								</Grid.RenderTransform>
                                <Image x:Name="DepthImage" Stretch="Fill"/>
                                <Canvas x:Name="OverlayCanvas" Background="Transparent" Panel.ZIndex="1"/>
                            </Grid>
                        </Viewbox>
                    </Border>
					<Border Grid.Row="1" Background="#F0F0F0" Padding="10">
						<TextBlock x:Name="StatusText" Text="Ready" HorizontalAlignment="Center" FontSize="12"/>
					</Border>
				</Grid>
			</Border>
			
			<!-- Simple Controls -->
			<Border Grid.Column="1" Background="White" CornerRadius="8" Margin="10,0,0,0">
				<ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Disabled">
					<StackPanel Margin="20">
					
					<!-- SIMPLE TOUCH DETECTION -->
					<GroupBox Header="ðŸŽ¯ Touch Detection" Margin="0,0,0,20">
						<StackPanel Margin="10">
							<TextBlock Text="Max Touch Distance (mm):" FontSize="11" Foreground="#333" Margin="0,5,0,0"/>
							<StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                            <Slider x:Name="PlaneThresholdSlider"
                                        Minimum="8" Maximum="15" Value="15"
                                        TickFrequency="1" TickPlacement="None"
                                        ValueChanged="PlaneThresholdSlider_ValueChanged"
                                        Width="150" Margin="0,0,10,0"/>
								<TextBlock x:Name="ThresholdValueText" Text="18mm" FontSize="11" Foreground="#333" 
										   VerticalAlignment="Center" MinWidth="40"/>
							</StackPanel>
                            <TextBlock Text="Maximum distance from wall for touch detection (8-15mm typical)" 
                                           FontSize="10" Foreground="#666" Margin="0,0,0,10"/>
							
							<TextBlock Text="Plane Threshold (mm):" FontSize="11" Foreground="#333" Margin="0,5,0,0"/>
							<StackPanel Orientation="Horizontal" Margin="0,2,0,0">
                            <Slider x:Name="PlaneToleranceSlider"
                                        Minimum="1" Maximum="5" Value="2.5"
                                        TickPlacement="None"
                                        ValueChanged="PlaneToleranceSlider_ValueChanged"
                                        Width="150" Margin="0,0,10,0"/>
								<TextBlock x:Name="PlaneToleranceValueText" Text="2.5mm" FontSize="11" Foreground="#333" 
										   VerticalAlignment="Center" MinWidth="40"/>
							</StackPanel>
							<TextBlock Text="Tolerance for plane detection" 
									   FontSize="10" Foreground="#666" Margin="0,0,0,10"/>
							
							<TextBlock Text="ðŸŽ¯ One-sided touch detection active!" FontSize="12" Foreground="#4CAF50" TextWrapping="Wrap" Margin="0,5,0,10" HorizontalAlignment="Center" FontWeight="Bold"/>
							<TextBlock Text="Ray-based detection with 3Ã—3 density filtering" FontSize="11" Foreground="#666" TextWrapping="Wrap" Margin="0,0,0,10" HorizontalAlignment="Center"/>
						</StackPanel>
					</GroupBox>
					
					<!-- STATUS -->
					<GroupBox Header="Status">
						<StackPanel Margin="10">
							<TextBlock x:Name="DetectionStatusText" Text="No touches detected" FontSize="14" Margin="0,0,0,5" FontWeight="Bold"/>
							<TextBlock x:Name="TouchCountText" Text="Active touches: 0" FontSize="12" Margin="0,0,0,5"/>
							<TextBlock x:Name="DepthInfoText" Text="Depth: --" FontSize="12"/>
						</StackPanel>
					</GroupBox>
					
                    <!-- MAIN ACTIONS -->
                    <Button x:Name="ResetViewButton" Content="RESET VIEW" Style="{StaticResource WizardButtonStyle}" Margin="0,10,0,0" Background="#607D8B" Click="ResetViewButton_Click"/>
					
					<!-- ADVANCED (HIDDEN BY DEFAULT) -->
					<Expander Header="âš™ï¸ Advanced Settings" Margin="0,20,0,20" IsExpanded="False">
						<StackPanel>
							<GroupBox Header="Camera View" Margin="0,0,0,15">
								<StackPanel Margin="10">
									<CheckBox x:Name="FlipDepthVerticallyCheckBox" IsChecked="True" Content="Flip depth vertically" Checked="FlipDepthVerticallyCheckBox_Changed" Unchecked="FlipDepthVerticallyCheckBox_Changed"/>
								</StackPanel>
							</GroupBox>
							
							<GroupBox Header="Touch Settings" Margin="0,0,0,15">
								<StackPanel Margin="10">
									<TextBlock Text="Min Object Size" FontWeight="Bold" Margin="0,0,0,5"/>
									<Slider x:Name="MinBlobAreaSlider"
									        Minimum="10" Maximum="60" Value="30"
									        TickFrequency="5" TickPlacement="None"
									        ValueChanged="MinBlobAreaSlider_ValueChanged"
									        Width="200"/>
									<TextBlock x:Name="MinBlobAreaValueText" Text="30 pts" HorizontalAlignment="Center" FontSize="12" Margin="0,5,0,10"/>
									
									<TextBlock Text="Max Object Size" FontWeight="Bold" Margin="0,10,0,5"/>
                                    <Slider x:Name="MaxBlobAreaSlider"
                                            Minimum="400" Maximum="5000" Value="2500"
                                            TickFrequency="50" TickPlacement="None"
                                            ValueChanged="MaxBlobAreaSlider_ValueChanged"
                                            Width="200"/>
                                    <TextBlock x:Name="MaxBlobAreaValueText" Text="2500 pts" HorizontalAlignment="Center" FontSize="12" Margin="0,5,0,10"/>
									
								</StackPanel>
							</GroupBox>
							
						</StackPanel>
					</Expander>
					
					<!-- FINAL ACTIONS -->
					<Button x:Name="FinishButton" Content="ðŸ’¾ Save &amp; Exit" Style="{StaticResource WizardButtonStyle}" Margin="0,10,0,0" Click="FinishButton_Click"/>
					<Button x:Name="CancelButton" Content="âŒ Cancel" Style="{StaticResource WizardButtonStyle}" Margin="0,10,0,0" Background="#F44336" Click="CancelButton_Click"/>
					</StackPanel>
				</ScrollViewer>
			</Border>
		</Grid>
		<Border Grid.Row="2" Background="#424242" Padding="10">
			<TextBlock Text="Screen 3 of 3: Touch Detection Test" Foreground="White" HorizontalAlignment="Center" FontSize="12"/>
		</Border>
	</Grid>
</Window>

